<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Retail Store Management</title>
  <link rel="stylesheet" href="css/style.css">
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
  <script src="https://cdn.jsdelivr.net/npm/jsbarcode@3.11.6/dist/JsBarcode.all.min.js"></script>
</head>
<body>
  <!-- Auth View -->
  <div id="authView" style="display: none;">
    <div class="auth-container">
      <div class="auth-card">
        <div class="auth-header">
          <h1><i class="fa-solid fa-store"></i> RetailPro</h1>
          <p>Retail Store Management System</p>
        </div>
        <div class="auth-tabs">
          <button class="auth-tab active" data-tab="login">Login</button>
          <button class="auth-tab" data-tab="signup">Sign Up</button>
        </div>
        <!-- Login Form -->
        <form id="loginForm" class="auth-form active">
          <div class="form-group">
            <label>Email</label>
            <input type="email" id="loginEmail" required>
          </div>
          <div class="form-group">
            <label>Password</label>
            <input type="password" id="loginPassword" required>
          </div>
          <button type="submit" class="btn primary full">Login</button>
        </form>
        <!-- Signup Form -->
        <form id="signupForm" class="auth-form">
          <div class="form-group">
            <label>Full Name</label>
            <input type="text" id="signupName" required>
          </div>
          <div class="form-group">
            <label>Email</label>
            <input type="email" id="signupEmail" required>
          </div>
          <div class="form-group">
            <label>Password</label>
            <input type="password" id="signupPassword" required minlength="6">
          </div>
          <div class="form-group">
            <label>Role</label>
            <select id="signupRole" required>
              <option value="Cashier">Cashier</option>
              <option value="Admin">Admin</option>
            </select>
          </div>
          <button type="submit" class="btn primary full">Create Account</button>
        </form>
      </div>
    </div>
  </div>

  <!-- App View -->
  <div id="appView" class="app">
    <!-- Sidebar -->
    <aside class="sidebar">
      <div class="logo">
        <i class="fa-solid fa-store"></i>
        <span>RetailPro</span>
      </div>
      <nav class="nav" id="mainNav">
        <button class="nav-btn" data-view="dashboard"><i class="fa-solid fa-chart-line"></i> Dashboard</button>
        <button class="nav-btn" data-view="pos"><i class="fa-solid fa-cash-register"></i> POS Billing</button>
        <button class="nav-btn" data-view="inventory"><i class="fa-solid fa-boxes-stacked"></i> Inventory</button>
        <button class="nav-btn" data-view="reports"><i class="fa-solid fa-file-lines"></i> Reports</button>
        <button class="nav-btn" data-view="users"><i class="fa-solid fa-users"></i> Users</button>
        <button class="nav-btn" data-view="barcode"><i class="fa-solid fa-barcode"></i> Barcodes</button>
        <button class="nav-btn" data-view="settings"><i class="fa-solid fa-gear"></i> Settings</button>
      </nav>
      <div class="sidebar-footer">
        <button id="logoutBtn" class="nav-btn danger"><i class="fa-solid fa-sign-out-alt"></i> Logout</button>
      </div>
    </aside>

    <!-- Main Content -->
    <main class="main">
      <!-- Header -->
      <header class="header">
        <button id="menuToggle" class="menu-toggle" title="Menu">
          <i class="fa-solid fa-bars"></i>
        </button>
        <div class="search-box">
          <i class="fa-solid fa-search"></i>
          <input type="text" id="globalSearch" placeholder="Search...">
        </div>
        <div class="header-actions">
          <button id="darkModeBtn" title="Toggle Dark Mode"><i class="fa-solid fa-moon"></i></button>
          <div class="user-info">
            <span id="userName">Guest</span>
            <span id="userRole" class="badge">-</span>
          </div>
        </div>
      </header>
      
      <!-- Mobile Overlay -->
      <div id="sidebarOverlay" class="sidebar-overlay"></div>

      <!-- Dashboard View -->
      <section id="dashboardView" class="view">
        <h2>Dashboard</h2>
        <div class="stats-grid">
          <div class="stat-card">
            <div class="stat-icon"><i class="fa-solid fa-indian-rupee-sign"></i></div>
            <div class="stat-info">
              <span class="stat-value" id="todaySales">₹0</span>
              <span class="stat-label">Today's Sales</span>
            </div>
          </div>
          <div class="stat-card">
            <div class="stat-icon"><i class="fa-solid fa-receipt"></i></div>
            <div class="stat-info">
              <span class="stat-value" id="todayOrders">0</span>
              <span class="stat-label">Today's Orders</span>
            </div>
          </div>
          <div class="stat-card">
            <div class="stat-icon"><i class="fa-solid fa-box"></i></div>
            <div class="stat-info">
              <span class="stat-value" id="totalProducts">0</span>
              <span class="stat-label">Total Products</span>
            </div>
          </div>
          <div class="stat-card warning">
            <div class="stat-icon"><i class="fa-solid fa-triangle-exclamation"></i></div>
            <div class="stat-info">
              <span class="stat-value" id="lowStockCount">0</span>
              <span class="stat-label">Low Stock Items</span>
            </div>
          </div>
          <div class="stat-card">
            <div class="stat-icon"><i class="fa-solid fa-dollar-sign"></i></div>
            <div class="stat-info">
              <span class="stat-value" id="inventoryValue">₹0</span>
              <span class="stat-label">Inventory Value</span>
            </div>
          </div>
        </div>
        <div class="dashboard-grid">
          <div class="card">
            <h3>Recent Transactions</h3>
            <div id="recentTransactions" class="list"></div>
          </div>
          <div class="card">
            <h3>Low Stock Alerts</h3>
            <div id="lowStockAlerts" class="list"></div>
          </div>
        </div>
      </section>

      <!-- POS View -->
      <section id="posView" class="view">
        <div class="pos-container">
          <div class="pos-products">
            <div class="pos-header">
              <input type="text" id="posSearch" placeholder="Search or scan barcode...">
              <select id="posCategory">
                <option value="">All Categories</option>
              </select>
            </div>
            <div id="posProducts" class="product-grid"></div>
          </div>
          <div class="pos-cart">
            <h3><i class="fa-solid fa-cart-shopping"></i> Current Bill</h3>
            <div id="cartItems" class="cart-items"></div>
            <div class="cart-summary">
              <div class="summary-row"><span>Subtotal</span><span id="cartSubtotal">₹0</span></div>
              <div class="summary-row"><span>Discount</span>
                <input type="number" id="discountInput" value="0" min="0" style="width:60px;text-align:right;">%
              </div>
              <div class="summary-row">
                <label style="display:flex;align-items:center;gap:8px;">
                  <input type="checkbox" id="gstToggle"> GST (18%)
                </label>
                <span id="cartTax">₹0</span>
              </div>
              <div class="summary-row total"><span>Total</span><span id="cartTotal">₹0</span></div>
            </div>
            <div class="cart-actions">
              <button id="holdBillBtn" class="btn secondary"><i class="fa-solid fa-pause"></i> Hold</button>
              <button id="clearCartBtn" class="btn danger"><i class="fa-solid fa-trash"></i> Clear</button>
              <button id="checkoutBtn" class="btn primary"><i class="fa-solid fa-check"></i> Checkout</button>
            </div>
          </div>
        </div>
      </section>

      <!-- Inventory View -->
      <section id="inventoryView" class="view">
        <div class="view-header">
          <h2>Inventory Management</h2>
          <div class="view-actions">
            <button onclick="openAddProduct()" class="btn primary"><i class="fa-solid fa-plus"></i> Add Product</button>
          </div>
        </div>
        <div class="filters">
          <input type="text" id="inventorySearch" placeholder="Search products..." onkeyup="filterInventory()">
          <select id="categoryFilter" onchange="filterInventory()">
            <option value="">All Categories</option>
            <option value="Electronics">Electronics</option>
            <option value="Clothing">Clothing</option>
            <option value="Food">Food</option>
            <option value="Other">Other</option>
          </select>
          <select id="stockFilter" onchange="filterInventory()">
            <option value="">All Stock Levels</option>
            <option value="ok">In Stock</option>
            <option value="low">Low Stock</option>
            <option value="out">Out of Stock</option>
          </select>
        </div>
        <div class="table-container">
          <table class="data-table">
            <thead>
              <tr>
                <th>Name</th>
                <th>SKU</th>
                <th>Category</th>
                <th>Price</th>
                <th>Stock</th>
                <th>Barcode</th>
                <th>Actions</th>
              </tr>
            </thead>
            <tbody id="inventoryTableBody"></tbody>
          </table>
        </div>
      </section>

      <!-- Users View -->
      <section id="usersView" class="view">
        <div class="view-header">
          <h2>User Management</h2>
          <div class="view-actions">
            <button onclick="openAddUser()" class="btn primary"><i class="fa-solid fa-user-plus"></i> Add User</button>
          </div>
        </div>
        <div class="filters">
          <input type="text" id="userSearch" placeholder="Search users..." onkeyup="filterUsers()">
          <select id="roleFilter" onchange="filterUsers()">
            <option value="">All Roles</option>
            <option value="Admin">Admin</option>
            <option value="Cashier">Cashier</option>
          </select>
        </div>
        <div class="table-container">
          <table class="data-table">
            <thead>
              <tr>
                <th>Name</th>
                <th>Email</th>
                <th>Role</th>
                <th>Created</th>
                <th>Status</th>
                <th>Actions</th>
              </tr>
            </thead>
            <tbody id="usersTableBody"></tbody>
          </table>
        </div>
      </section>

      <!-- Reports View -->
      <section id="reportsView" class="view">
        <h2>Sales Reports</h2>
        <div class="stats-grid">
          <div class="stat-card">
            <div class="stat-icon"><i class="fa-solid fa-calendar-day"></i></div>
            <div class="stat-info">
              <span class="stat-value" id="reportTodaySales">₹0</span>
              <span class="stat-label">Today's Sales</span>
            </div>
          </div>
          <div class="stat-card">
            <div class="stat-icon"><i class="fa-solid fa-calendar-week"></i></div>
            <div class="stat-info">
              <span class="stat-value" id="reportMonthSales">₹0</span>
              <span class="stat-label">This Month</span>
            </div>
          </div>
          <div class="stat-card">
            <div class="stat-icon"><i class="fa-solid fa-chart-line"></i></div>
            <div class="stat-info">
              <span class="stat-value" id="reportTotalSales">₹0</span>
              <span class="stat-label">Total Sales</span>
            </div>
          </div>
          <div class="stat-card">
            <div class="stat-icon"><i class="fa-solid fa-receipt"></i></div>
            <div class="stat-info">
              <span class="stat-value" id="reportAvgTransaction">₹0</span>
              <span class="stat-label">Avg Transaction</span>
            </div>
          </div>
        </div>
        <div class="dashboard-grid">
          <div class="card">
            <h3>Top Selling Products</h3>
            <div id="topProductsList" class="list"></div>
          </div>
          <div class="card">
            <h3>Recent Bills</h3>
            <div id="reportBillsList" class="list"></div>
          </div>
        </div>
      </section>

      <!-- Barcodes View -->
      <section id="barcodeView" class="view">
        <h2>Barcode Generator</h2>
        <div class="barcode-section">
          <div class="form-group">
            <label>Select Product</label>
            <select id="barcodeProductSelect"></select>
          </div>
          <div class="form-group">
            <label>Or Enter Barcode Number</label>
            <input type="text" id="barcodeInput" placeholder="Enter barcode number">
            <button onclick="generateRandomBarcode()" class="btn secondary" style="margin-top:8px;">
              <i class="fa-solid fa-dice"></i> Generate Random
            </button>
          </div>
          <div class="form-group">
            <button onclick="generateBarcode()" class="btn primary">Generate Barcode</button>
            <button onclick="printBarcode()" class="btn secondary">
              <i class="fa-solid fa-print"></i> Print
            </button>
          </div>
        </div>
        <div id="barcodeDisplay" class="barcode-display"></div>
      </section>

      <!-- Settings View -->
      <section id="settingsView" class="view">
        <h2>Settings</h2>
        <div class="settings-grid">
          <div class="card">
            <h3>Shop Details</h3>
            <form id="settingsForm">
              <div class="form-group">
                <label>Shop Name</label>
                <input type="text" id="shopName" required>
              </div>
              <div class="form-group">
                <label>Address</label>
                <textarea id="shopAddress" rows="2"></textarea>
              </div>
              <div class="form-group">
                <label>Phone</label>
                <input type="tel" id="shopPhone">
              </div>
              <div class="form-group">
                <label>Email</label>
                <input type="email" id="shopEmail">
              </div>
              <div class="form-group">
                <label>GST Number</label>
                <input type="text" id="shopGst">
              </div>
              <button type="submit" class="btn primary">Save Settings</button>
            </form>
          </div>
          <div class="card">
            <h3>Preferences</h3>
            <div class="form-group">
              <label style="display:flex;align-items:center;gap:8px;">
                <input type="checkbox" id="darkModeToggle" onchange="toggleDarkMode()">
                <span>Dark Mode</span>
              </label>
            </div>
          </div>
          <div class="card">
            <h3>Data Management</h3>
            <div class="settings-actions">
              <button onclick="exportData()" class="btn secondary"><i class="fa-solid fa-download"></i> Export Data</button>
              <button onclick="importData()" class="btn secondary"><i class="fa-solid fa-upload"></i> Import Data</button>
              <input type="file" id="importFile" accept=".json" onchange="handleImport(event)" style="display:none;">
            </div>
          </div>
        </div>
      </section>
    </main>
  </div>

  <!-- Toast Container -->
  <div id="toastContainer" class="toast-container"></div>

  <!-- Product Modal -->
  <div id="productModal" class="modal hidden">
    <div class="modal-content">
      <div class="modal-header">
        <h3 id="productModalTitle">Add Product</h3>
        <button class="modal-close" onclick="closeProductModal()">&times;</button>
      </div>
      <form id="productForm">
        <input type="hidden" id="productId">
        <div class="form-group">
          <label>Product Name *</label>
          <input type="text" id="productName" required>
        </div>
        <div class="form-row">
          <div class="form-group">
            <label>SKU</label>
            <input type="text" id="productSku">
          </div>
          <div class="form-group">
            <label>Category</label>
            <input type="text" id="productCategory" list="categories">
            <datalist id="categories">
              <option value="Electronics">
              <option value="Clothing">
              <option value="Food">
              <option value="Other">
            </datalist>
          </div>
        </div>
        <div class="form-row">
          <div class="form-group">
            <label>Price *</label>
            <input type="number" id="productPrice" min="0" step="0.01" required>
          </div>
          <div class="form-group">
            <label>Quantity *</label>
            <input type="number" id="productQuantity" min="0" required>
          </div>
        </div>
        <div class="form-group">
          <label>Barcode</label>
          <input type="text" id="productBarcode">
        </div>
        <div class="modal-footer">
          <button type="button" class="btn secondary" onclick="closeProductModal()">Cancel</button>
          <button type="submit" class="btn primary">Save Product</button>
        </div>
      </form>
    </div>
  </div>

  <!-- User Modal -->
  <div id="userModal" class="modal hidden">
    <div class="modal-content">
      <div class="modal-header">
        <h3 id="userModalTitle">Add User</h3>
        <button class="modal-close" onclick="closeUserModal()">&times;</button>
      </div>
      <form id="userForm">
        <input type="hidden" id="userId">
        <div class="form-group">
          <label>Full Name *</label>
          <input type="text" id="userFullName" required>
        </div>
        <div class="form-group">
          <label>Email *</label>
          <input type="email" id="userEmail" required>
        </div>
        <div class="form-group" id="passwordGroup">
          <label>Password *</label>
          <input type="password" id="userPassword" minlength="6">
          <small>Minimum 6 characters</small>
        </div>
        <div class="form-group">
          <label>Role *</label>
          <select id="userRole" required>
            <option value="Cashier">Cashier</option>
            <option value="Admin">Admin</option>
          </select>
        </div>
        <div class="form-group">
          <label>Status</label>
          <select id="userStatus">
            <option value="active">Active</option>
            <option value="inactive">Inactive</option>
          </select>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn secondary" onclick="closeUserModal()">Cancel</button>
          <button type="submit" class="btn primary">Save User</button>
        </div>
      </form>
    </div>
  </div>

  <!-- Checkout Modal -->
  <div id="checkoutModal" class="modal hidden">
    <div class="modal-content">
      <div class="modal-header">
        <h3>Complete Sale</h3>
        <button class="modal-close" onclick="closeCheckout()">&times;</button>
      </div>
      <form id="checkoutForm" onsubmit="completeSale(event)">
        <div class="checkout-summary">
          <div class="summary-row">
            <span>Subtotal:</span>
            <span id="checkoutSubtotal">₹0</span>
          </div>
          <div class="summary-row">
            <span>GST (18%):</span>
            <span id="checkoutTax">₹0</span>
          </div>
          <div class="summary-row total">
            <span>Total Amount:</span>
            <span id="checkoutTotal">₹0</span>
          </div>
        </div>
        <div class="form-group">
          <label>Payment Method</label>
          <select id="paymentMethod">
            <option value="cash">Cash</option>
            <option value="card">Card</option>
            <option value="upi">UPI</option>
          </select>
        </div>
        <div class="form-group">
          <label>Amount Paid</label>
          <input type="number" id="amountPaid" min="0" step="0.01" oninput="calculateChange()" required>
          <div class="change-display">Change: <span id="changeAmount">₹0</span></div>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn secondary" onclick="closeCheckout()">Cancel</button>
          <button type="submit" class="btn primary"><i class="fa-solid fa-check"></i> Complete Sale</button>
        </div>
      </form>
    </div>
  </div>
  </div> <!-- End of App View -->

  <!-- Loading Overlay -->
  <div id="loadingOverlay" class="loading-overlay">
    <div class="spinner"></div>
  </div>

  <!-- Toast Container -->
  <div id="toastContainer" class="toast-container"></div>

  <!-- Firebase SDK -->
  <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore-compat.js"></script>
  
  <!-- Firebase Config -->
  <script src="js/firebase-config.js"></script>
  
  <!-- App -->
  <script src="js/app.js"></script>
</body>
</html>
